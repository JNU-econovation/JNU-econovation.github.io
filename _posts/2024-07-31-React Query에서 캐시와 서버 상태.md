---
layout: post
title: React Queryì—ì„œ ìºì‹œì™€ ì„œë²„ ìƒíƒœ
subtitle: React Queryì—ì„œ ìºì‹œì™€ ì„œë²„ ìƒíƒœ
author: geongyu
categories: TECH
banner:
  image: "https://github.com/user-attachments/assets/3ee78baa-3eed-4dce-9420-94945ff8ed0a"
tags: TECH
sidebar: []
---

# React Queryì—ì„œ ìºì‹œì™€ ì„œë²„ ìƒíƒœ

>ì•ˆë…•í•˜ì„¸ìš” ì—ì½”ë…¸ë² ì´ì…˜ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì ë°•ê±´ê·œì…ë‹ˆë‹¤. \
>í•´ë‹¹ ê¸€ì€Â CSì˜Â ìºì‹œë¥¼Â react-queryì—Â ëŒ€ì…í•˜ì—¬ ì„¤ëª…í•˜ëŠ”Â ê¸€ì…ë‹ˆë‹¤.Â ì´ëŠ” 100% ê¸€ì“´ì´ì˜ ê°œì¸ì ì¸Â ìƒê°ì´ë¯€ë¡œÂ ë¹„íŒì ìœ¼ë¡œ ê¸€ì„ ë°”ë¼ë³¼ í•„ìš”ì„±ì´ ìˆìŠµë‹ˆë‹¤.
> 

# â‰ï¸Â ìºì‹œì— ëŒ€í•´ì„œ ì•„ì‹œë‚˜ìš”?

ì»´ê³µê³¼, í˜¹ì€ ê´€ë ¨ í•™ê³¼ ì¶œì‹ ì´ë¼ë©´ í•„ìˆ˜ì ìœ¼ë¡œ ë“£ëŠ” ìš´ì˜ì²´ì œë‚˜ ì»´í“¨í„° êµ¬ì¡°ì™€ ê°™ì€ ê³¼ëª©ì—ì„œ ìºì‹œì— ëŒ€í•œ ë‚´ìš©ì„ ì¢…ì¢… ì ‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

> ìºì‹œ (cache)
**ìºì‹œ**(cache,Â [ë¬¸í™”ì–´](https://ko.wikipedia.org/wiki/%EB%AC%B8%ED%99%94%EC%96%B4):Â ìºì‰¬, ê³ ì†ì™„ì¶©ê¸°, ê³ ì†ì™„ì¶©ê¸°ì–µê¸°)ëŠ”Â [ì»´í“¨í„° ê³¼í•™](https://ko.wikipedia.org/wiki/%EC%BB%B4%ED%93%A8%ED%84%B0_%EA%B3%BC%ED%95%99)ì—ì„œ ë°ì´í„°ë‚˜ ê°’ì„ ë¯¸ë¦¬ ë³µì‚¬í•´ ë†“ëŠ” ì„ì‹œ ì¥ì†Œë¥¼ ê°€ë¦¬í‚¨ë‹¤. ìºì‹œëŠ” ìºì‹œì˜ ì ‘ê·¼ ì‹œê°„ì— ë¹„í•´Â [ë¯¸ê°€ê³µ ë°ì´í„°](https://ko.wikipedia.org/wiki/%EB%AF%B8%EA%B0%80%EA%B3%B5_%EB%8D%B0%EC%9D%B4%ED%84%B0)Â ë˜ëŠ”Â **1ì°¨ ë°ì´í„°**(raw data or primary data)ì— ì ‘ê·¼í•˜ëŠ” ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ê²½ìš°ë‚˜ ê°’ì„ ë‹¤ì‹œ ê³„ì‚°í•˜ëŠ” ì‹œê°„ì„ ì ˆì•½í•˜ê³  ì‹¶ì€ ê²½ìš°ì— ì‚¬ìš©í•œë‹¤. 
ìºì‹œì— ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë³µì‚¬í•´ ë†“ìœ¼ë©´ ê³„ì‚°ì´ë‚˜ ì ‘ê·¼ ì‹œê°„ ì—†ì´ ë” ë¹ ë¥¸ ì†ë„ë¡œ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
\
ìºì‹œëŠ” ì‹œìŠ¤í…œì˜ íš¨ìœ¨ì„±ì„ ìœ„í•´ ì—¬ëŸ¬ ë¶„ì•¼ì—ì„œ ë‘ë£¨ ì“°ì´ê³  ìˆë‹¤.
\
> \
ì¶œì²˜-[ìœ„í‚¤ ë°±ê³¼]([https://ko.wikipedia.org/wiki/ìºì‹œ](https://ko.wikipedia.org/wiki/%EC%BA%90%EC%8B%9C))
> 

í° ë…¸ì´ë§Œ êµ¬ì¡°ë¥¼ ë„ê³  ìˆëŠ” ì»´í“¨í„°ì—ì„œëŠ” ë©”ëª¨ë¦¬ì— ìˆëŠ” ë°ì´í„° ë° ëª…ë ¹ì–´ë“¤ì„ cpuë¡œ ë²„ìŠ¤ë¥¼ í†µí•´ ê°€ì ¸ì™€ ì‹¤í–‰í•˜ê²Œ ë©ë‹ˆë‹¤. 

ì´ë•Œ ë¬¼ë¦¬ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ê°€ cpuë³´ë‹¤ ëŠë¦´ ìˆ˜ë°–ì— ì—†ëŠ”ë°ìš”. ì´ë¡œ ì¸í•´ì„œ ë°˜ì‘ì„±ì´ ë–¨ì–´ì§€ëŠ” ë¬¸ì œê°€ ì¡´ì¬í•©ë‹ˆë‹¤. 

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ ë¬¼ë¦¬ì ìœ¼ë¡œ ë” ê°€ê¹Œìš´ ìœ„ì¹˜ì— ë©”ëª¨ë¦¬ë³´ë‹¤ ë¹ ë¥¸ ìºì‹œë¥¼ ì¤‘ê°„ì— ë‘ê²Œ ë©ë‹ˆë‹¤. 

![Untitled (1)](https://github.com/user-attachments/assets/c8c5615b-4654-42bd-9825-385e8def77d5)

ìºì‹œì—ëŠ” ì‚¬ìš©ëœ, í˜¹ì€ ì‚¬ìš©ë  ë°ì´í„°ë¥¼ ì €ì¥í•´ë‘ëŠ”ë°ìš”. ë•ë¶„ì— ë§Œì•½ ì°¾ê³ ì í•˜ëŠ” ë°ì´í„°ê°€ ì´ë¯¸ cacheì— ìˆë‹¤ë©´ ë”ìš± ë¹ ë¥´ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤! ë˜í•œ ë°ì´í„°ì˜ ë¡œì»¬ë¦¬í‹°ì  íŠ¹ì„± ë•ë¶„ì— ëŒ€ì²´ë¡œ ì–´ë–¤ ë°ì´í„°ê°€ ì‚¬ìš©ë ì§€ì— ëŒ€í•´ì„œë„ ì–´ëŠ ì •ë„ ì˜ˆìƒì´ ê°€ëŠ¥í•˜ê¸°ë„ í•©ë‹ˆë‹¤. 

ì˜ˆë¥¼ ë“¤ë©´ ì´ëŸ° ê²ƒë“¤ì…ë‹ˆë‹¤.

- â€œí•œë²ˆ ì‚¬ìš©í•œ ë°ì´í„°ëŠ” ë‹¤ì‹œ ì¬ì‚¬ìš© ë  í™•ë¥ ì´ ë†’ë‹¤.â€
- â€œì‚¬ìš©ëœ ë¶€ë¶„ì˜ ê·¸ë‹¤ìŒ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤. â€œ
    - (ëª…ë ¹ë¬¸ì„ ê°€ì ¸ì™€ ì‹¤í–‰í–ˆë‹¤ë©´, ê·¸ ë‹¤ìŒ ì‹¤í–‰ë  ëª…ë ¹ë¬¸ì€ ë‹¤ìŒ ì¤„(ë‹¤ìŒ ì£¼ì†Œ)ì¼ ê²ƒì´ë‹¤.)

ì´ì²˜ëŸ¼ ìƒê°ë³´ë‹¤ ìºì‹œì˜ ê°œë…ì€ ì •ë§ ê°„ë‹¨í•©ë‹ˆë‹¤! 

### ìºì‹œ ê°œë… í™•ëŒ€í•˜ê¸°_ì›¹(web)

ì‚¬ì‹¤ ì´ë ‡ê²Œ ê¹Šì´ ìˆê²Œ ìºì‹œì— ëŒ€í•´ì„œ ì•Œì§€ ëª»í•´ë„, ëŒ€ë¶€ë¶„ì˜ ì‚¬ëŒë“¤ì€ ìºì‹œë¼ëŠ” ë§ì„ ë§ì´ ë“¤ì–´ë³´ì…¨ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ìºì‹œë¼ëŠ” ìš©ì–´ë¥¼ cpu-memoryì˜ í° ë…¸ì´ë§Œ êµ¬ì¡° ì™¸ì—ë„ ë‹¤ì–‘í•œ ê³³ì—ì„œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì¸ë°ìš”. ì €í¬ë„ í•´ë‹¹ ê°œë…ì„ ì¢€ ë„“í˜€ ì›¹ì— ëŒ€ì…í•´ ë³´ê² ìŠµë‹ˆë‹¤. 

- ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆëŠ” **ë©”ëª¨ë¦¬**ë¥¼ ì›¹ ì„œë¹„ìŠ¤ì—ì„œ ì „ì²´ì ì¸ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” **ì„œë²„**ë¡œ,
- ë°ì´í„°ë¥¼ ì†Œë¹„í•˜ëŠ” **cpu**ë¥¼ ì›¹ ì„œë¹„ìŠ¤ì—ì„œ ë°ì´í„°ë¥¼ í†µí•´ uië¥¼ ë³´ì—¬ì£¼ëŠ” **ë¸Œë¼ìš°ì €**(í˜¹ì€ **í´ë¼ì´ì–¸íŠ¸**)ë¡œ ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤!
- ê·¸ë¦¬ê³  ì´ë™ ìˆ˜ë‹¨ì¸ **ë²„ìŠ¤**ë¥¼ **ë„¤íŠ¸ì›Œí¬**ë¡œ ë³¼ ìˆ˜ ìˆê² ë„¤ìš”!

ìƒê°ë³´ë‹¤ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ì˜ í†µì‹ ì€ ë¶ˆì•ˆì •í•˜ê³ , ëŠë¦½ë‹ˆë‹¤. ì‚¬ìš©ì ì…ì¥ì—ì„œ ì¢‹ì€ ê²½í—˜ì„ ì£¼ì–´ì•¼ í•˜ëŠ” ì›¹ ê°œë°œì ì…ì¥ì—ì„œëŠ” ì´ëŸ¬í•œ ë¹„ìš©ì„ ì¤„ì´ëŠ” ê²ƒì´ í° ê³¼ì œì¸ë°ìš”. ğŸ¤” ì—¬ê¸°ì—ë„ ë™ì¼í•˜ê²Œ ìºì‹œë¥¼ ì ìš©í•´ ë³¼ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œìš”?  

## ì„œë²„ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” react-query

![Untitled 1](https://github.com/user-attachments/assets/3ee78baa-3eed-4dce-9420-94945ff8ed0a)

Reactì™€ í•¨ê»˜ ìì£¼ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ react-queryê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ëŠ” ì„œë²„ ë°ì´í„° ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ë°ìš”. 

ë¨¼ì € ì„œë²„ ìƒíƒœê°€ ë¬´ì—‡ì¸ì§€ë¥¼ ì •ì˜í•´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤. 

ìš°ì„  ë¦¬ì•¡íŠ¸ì—ì„œëŠ” ìƒíƒœ(state)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤. ì´ëŠ” í•˜ë‚˜ì˜ ë°ì´í„°ë¡œ, ìƒíƒœê°’ì´ ë³€í•˜ê²Œ ë˜ë©´ í•´ë‹¹ ë¶€ë¶„ì„ ìµœì‹ í™”ëœ ìƒíƒœê°’ìœ¼ë¡œ ë‹¤ì‹œ ë Œë”ë§ì„ í•´ì£¼ê²Œ ë©ë‹ˆë‹¤. 

ìƒíƒœê°’ì€ í¬ê²Œ ë‘ê°€ì§€ë¡œ ë‚˜ëˆ ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. 

- **í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ** : ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ì˜ ì¼ì‹œì  ìƒíƒœë¥¼ ê´€ë¦¬
    - ex) ëª¨ë‹¬ ì°½ì˜ ì—´ë¦¼/ë‹«í˜ ìƒíƒœ, í¼ ì…ë ¥ê°’ ë“±
- **ì„œë²„ ìƒíƒœ** : ì™¸ë¶€ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° ê´€ë¦¬.
    - ex) ì‚¬ìš©ì í”„ë¡œí•„ ë°ì´í„°, ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ ë“±

ì¦‰ ì„œë²„ ìƒíƒœë€ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ, í•´ë‹¹ ë°ì´í„°ì˜ ë³€ê²½ì— ë”°ë¼ ì¬ë Œë”ë§ì„ í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. 

ê°„ë‹¨íˆ fetch ë¬¸ì„ í†µí•´ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ìƒíƒœì— ì €ì¥í•´ ì¤„ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. 

```jsx
function TodoList() {
  const [todos, setTodos] = useState([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchTodos = async () => {
      setIsLoading(true);
      try {
	      // ë°ì´í„°ë¥¼ fetching í•©ë‹ˆë‹¤. 
        const response = await fetch('https://api.example.com/todos');
        const data = await response.json();
        // ì´ë ‡ê²Œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ìƒíƒœê°’ì— ë„£ì–´ì¤ë‹ˆë‹¤. 
        setTodos(data);
      } catch (err) {
        setError(err);
      } finally {
        setIsLoading(false);
      }
    };

    fetchTodos();
  }, []);

  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error: {error.message}</div>;

  return (
    <ul>
      {todos.map(todo => (
        <li key={todo.id}>{todo.title}</li>
      ))}
    </ul>
  );
}
```

ë¬¼ë¡  ë°ì´í„°ê°’ë§Œ ë‹¤ë£¨ë©´ ì•ˆ ë©ë‹ˆë‹¤. (`isLoading`, `error`ì™€ ê°™ì€) ë°ì´í„°ê°€ ì–´ë–¤ ìƒíƒœì¸ì§€ ë˜í•œ ìƒíƒœê°’ìœ¼ë¡œ ê´€ë¦¬í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. ê·¸ë˜ì•¼ ìœ ì €ì—ê²Œ í˜„ì¬ ìƒíƒœì— ì˜¬ë°”ë¥¸ uië¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆì„ ê²ë‹ˆë‹¤.

ìŒ.. ì½”ë“œë¥¼ ë³´ë‹ˆ ì„œë²„ ìš”ì²­ ë¡œì§ê³¼, ì´ë¥¼ ìƒíƒœë¡œ ì €ì¥í•˜ëŠ” ë¡œì§ì´ ì»´í¬ë„ŒíŠ¸ì— ìˆìœ¼ë‹ˆê¹Œ ìƒê°ë³´ë‹¤ ì¡°ê¸ˆ ë³µì¡í•˜ë„¤ìš”.. ê·¸ë˜ë„ ì•„ì§ì€ ë´ì¤„ ë§Œí•œ ì •ë„ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ì¡°ê¸ˆ ë” ë“¤ì–´ê°€ ë´…ì‹œë‹¤.

ì´ì „ì— ì„¤ëª…í•œ ìºì‹± ê¸°ì–µí•˜ì‹œë‚˜ìš”? ìœ„ì™€ ê°™ì´ fetchë¥¼ í•˜ê³  ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” ì‹œê°„ì„ ë‹¨ì¶•í•˜ê¸° ìœ„í•´, ì´ì „ì— í•œë²ˆ ìš”ì²­ì„ í–ˆë˜ ë°ì´í„°ëŠ” ìºì‹œì— ì €ì¥í•˜ë„ë¡ í•˜ë©´ ì¡°ê¸ˆ ë” ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. 

ìºì‹±ê¹Œì§€ êµ¬í˜„ì„ í•´ë³´ê¸° ìœ„í•´ WeekMapì„ ë§Œë“¤ì–´ ì´ë¥¼ í´ë¡œì €ë¡œ ë‘ì–´ ì‚¬ë¼ì§€ì§€ ì•Šê²Œ í•˜ê³ , ì„œë²„ ìš”ì²­ ë¡œì§ì„ ì±…ì„ì„ ë¶„ë¦¬í•˜ê³  ìºì‹± ë¡œì§ì„ ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ë°ì½”ë ˆì´í„° íŒ¨í„´ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤ë§Œ.. ìƒê°ë§Œ í•´ë„ ë„ˆë¬´ë‚˜ ë³µì¡í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤ğŸ¤¯ğŸ¤·â€â™‚ï¸.. ë°ì´í„° í•˜ë‚˜ë¥¼ ê°€ì ¸ì˜¤ë ¤ê³  ì½”ë“œ ì‘ì„±ì— ë„ˆë¬´ë‚˜ë„ ë§ì€ ë¹„ìš©ì´ ë“¤ì–´ê°€ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ì´ëŸ¬í•œ ë¬¸ì œì ì„ í•´ê²°í•´ ì¤„ ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ê·¸ê²Œ ë°”ë¡œ react-queryì…ë‹ˆë‹¤. 

> **â—ï¸ì£¼ì˜â—ï¸**
react-queryëŠ” ë‹¨ìˆœíˆ ì„œë²„ ìš”ì²­ ê´€ë ¨ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ë¥¼ ì¤„ì´ê¸° ìœ„í•´ ë‚˜ì˜¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì•„ë‹™ë‹ˆë‹¤. ì„œë²„ ìš”ì²­ ë° ì„œë²„ ìƒíƒœì™€ ê´€ë ¨í•œ ì—¬ëŸ¬ ë¬¸ì œ ìƒí™©ì— ëŒ€í•œ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. ê³¼ê±°ì— Reduxì™€ ê°™ì€ ì „ì—­ ìƒíƒœ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ê°€ì§„ ì—¬ëŸ¬ ì±…ì„ë“¤ ì¤‘ì—ì„œ ì„œë²„ ìƒíƒœë¥¼ ë‚˜ëˆ„ì–´ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œ ë‚˜ì™”ë‹¤ê³  ìƒê°í•˜ëŠ” ê²ƒì´ ì¡°ê¸ˆ ë” ë§ëŠ” ë°©í–¥ì…ë‹ˆë‹¤!
> 

> **â—ï¸ì£¼ì˜â—ï¸**
ë˜í•œ react-queryëŠ” ìœ„ì—ì„œ ì„¤ëª…í•œ ëŒ€ë¡œ WeekMap ë° í´ë¡œì €ì™€ ë°ì½”ë ˆì´í„°ë¡œ ë§Œë“¤ì–´ì¡Œë‹¤ëŠ” ë§ì´ ì•„ë‹™ë‹ˆë‹¤. êµ¬í˜„ ì‚¬í•­ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ê¹ƒí—ˆë¸Œ ì½”ë“œë¥¼ ì°¸ê³ í•˜ì…”ë„ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.
> 

### react-query ì˜ ë™ì‘ ë°©ì‹

react-queryì˜ ë™ì‘ì€ ìœ„ì—ì„œ ì„¤ëª…í•œ ìºì‹œì— ëŒ€ì…í•´ì„œ ìƒê°í•´ ë³´ë©´ ì •ë§ ê°„ë‹¨í•©ë‹ˆë‹¤. ì„œë²„ ìš”ì²­ì—ì„œ ì¤‘ê°„ ë‹¤ë¦¬ì¸ ìºì‹œì˜ ì—­í• ì„ í•´ì£¼ê³  ìˆê¸° ë•Œë¬¸ì´ì§€ìš”!

![Untitled 2](https://github.com/user-attachments/assets/c26a19a8-b1f2-49b4-9faa-d5152f454b21)

- ìš°ì„  ì„œë²„ì˜ ë°ì´í„°ë“¤ì„ ìºì‹± í•´ ë‘¡ë‹ˆë‹¤.
    - ë§Œì•½ ìºì‹± ëœ ê°’ì´ ì—†ë‹¤ë©´ fetchë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
        - ë°›ì•„ì˜¨ ê°’ìœ¼ë¡œ ì§€ì •ëœ keyì— ìºì‹± í•´ ë‘¡ë‹ˆë‹¤.
    - ë§Œì•½ ìºì‹± ëœ ê°’ì´ ìˆë‹¤ë©´ í•´ë‹¹ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    - ë°ì´í„°ì˜ ìƒíƒœê°€ fresh í•˜ë‹¤ë©´ ì•„ë¬´ëŸ° ì¡°ì¹˜ë¥¼ ì·¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    - ë°ì´í„°ì˜ ìƒíƒœê°€ staleí•˜ë‹¤ë©´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì„œë²„ë¡œ fetch í•˜ë©°, ë°›ì•„ì˜¨ ë°ì´í„°ë¡œ ìƒˆë¡­ê²Œ ìºì‹œë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.

ì—¬ê¸°ì„œ ë“¤ ìˆ˜ ìˆëŠ” ì˜ë¬¸ì€ [ì–¸ì œê¹Œì§€ fresh time ì¸ì§€](https://tanstack.com/query/latest/docs/framework/react/reference/useQuery) ì¼ ê²ë‹ˆë‹¤. ì´ëŠ” useQueryë¥¼ ì‚¬ìš©í•  ë•Œ ë³€ê²½ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. 

react-queryë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ê°œë°œìëŠ” ì—„ì²­ë‚œ ì„±ëŠ¥ì  ì´ë“ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ì ì ˆí•˜ê²Œ stale timeê³¼ ê°™ì€ ê°’ì„ ì¡°ì ˆí•˜ëŠ” ê²ƒì´ ê°œë°œìì˜ ì—­ëŸ‰ì´ë¼ê³  ë³¼ ìˆ˜ë„ ìˆê² ë„¤ìš”!

## ë‹¤ë§Œ.. ì¢‹ë‹¤ê³  ì•„ë¬´ë ‡ê²Œë‚˜ ì‚¬ìš©í•˜ë©´ ì•ˆë©ë‹ˆë‹¤_ìºì‹± ì „ëµ

ë‹¤ì‹œí•œë²ˆ ì»´í“¨í„° êµ¬ì¡°ì˜ ìºì‹œë¥¼ ê°€ì ¸ì˜¤ê² ìŠµë‹ˆë‹¤. 

![Untitled 3](https://github.com/user-attachments/assets/3669259f-8bf0-47e8-a73c-15fc5a5ec009)

ìºì‹œì— ë“¤ì–´ìˆëŠ” ë°ì´í„° ì¼ë¶€ë¥¼ ê°€ì ¸ì™€ cpuëŠ” ì¼ì„ ìˆ˜í–‰í•  ê²ƒì…ë‹ˆë‹¤. ì´ë•Œ ë°ì´í„°ë¥¼ ë³€ê²½ í›„ ì €ì¥í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ì¡´ì¬í•˜ëŠ”ë°, ì´ë•Œ ìºì‹œì™€ ë©”ëª¨ë¦¬ì˜ ë™ê¸°í™” ì „ëµì—ëŠ” ëª‡ ê°€ì§€ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. 

1. Write-Through
- ìºì‹œì˜ ê°’ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ ë§¤ë²ˆ ë©”ëª¨ë¦¬ì—ë„ í•´ë‹¹ ë°ì´í„°ë¥¼ ë³€ê²½í•´ ì¤€ë‹¤.
- ì´ëŠ” ìºì‹œì™€ ë©”ëª¨ë¦¬ì— ìˆëŠ” ë™ì¼í•œ ë°ì´í„°ê°€ ë™ì¼í•œ ê°’ì„ ê°€ì§„ë‹¤.
- ë§¤ë²ˆ ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•˜ê²Œ ë˜ë¯€ë¡œ ì„±ëŠ¥ì ìœ¼ë¡œ ì¢‹ì§€ ì•Šë‹¤.

1. Write-Back
- ë°ì´í„°ê°’ì´ ë³€ê²½ë˜ë©´, ìºì‹œì—ë§Œ ê°’ì„ ë³€ê²½í•˜ë©°, ë©”ëª¨ë¦¬ëŠ” ë³€ê²½í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì´í›„ì— ë§Œì•½ í•´ë‹¹ ë°ì´í„°ê°€ ìºì‹œì—ì„œ ë‚´ë ¤ê°€ê²Œ ë˜ë©´ ê·¸ë•Œ ë©”ëª¨ë¦¬ì— ë°˜ì˜í•œë‹¤.
- Write-Through ë°©ì‹ì˜ ì„±ëŠ¥ì ì¸ ë¬¸ì œì ì„ ê°œì„ í•˜ê¸° ìœ„í•˜ì—¬ ë‚˜ì˜¤ê²Œ ë˜ì—ˆë‹¤.

ì´ëŸ¬í•œ ìºì‹œ-ë©”ëª¨ë¦¬ ë™ê¸°í™” ì „ëµì„ ìºì‹œì˜ ê°œë…ì´ ì ìš©ëœ react queryì—ì„œë„ ë³¼ ìˆ˜ ìˆëŠ”ë°ìš”! 

### ì„œë²„ì™€ ë™ê¸°í™”í•˜ê¸°

ì›¹ì—ì„œ ì„œë²„ ë°ì´í„°ê°’ì„ ë³€ê²½í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ìˆë‹¤ê³  ìƒê°í•´ ë³´ê² ìŠµë‹ˆë‹¤. ì„œë²„ì˜ ìƒíƒœê°€ ë³€ê²½ë¨ì— ë”°ë¼ì„œ ìºì‹œì— ì €ì¥ëœ ê°’ê³¼ ì‹¤ì œ ì„œë²„ì— ì €ì¥ëœ ë°ì´í„°ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ ì €ì˜ ì…ì¥ì—ì„œëŠ” ë¶„ëª…íˆ ë°ì´í„°ê°€ ë°”ë€Œì–´ì•¼ í•˜ëŠ”ë°, ìºì‹± ëœ ì´ì „ì˜ ë°ì´í„°ë§Œ ë³´ì—¬ì£¼ê²Œ ë˜ë©´ ë§ì´ ë‹¹í™©ìŠ¤ëŸ¬ìš¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ìºì‹± ëœ ë°ì´í„°ë¥¼ ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ë³€ê²½í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ìƒˆë¡­ê²Œ ê°€ì ¸ì™€ì„œ í•´ë‹¹ ë°ì´í„°ë¡œ ë‹¤ì‹œ ì €ì¥í•˜ë©´ í•´ê²°í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. 

react-queryì—ì„œ ì´ì— ëŒ€í•œ ì†”ë£¨ì…˜ì„ ì œê³µí•˜ê³  ìˆëŠ”ë°ìš”. ë°”ë¡œ `invalidateQuery` ì…ë‹ˆë‹¤. [ì°¸ê³  ë§í¬](https://tanstack.com/query/latest/docs/reference/QueryClient/#queryclientinvalidatequeries)

```jsx
await queryClient.invalidateQueries(
  {
    queryKey: ['posts'],
    exact,
    refetchType: 'active',
  },
  { throwOnError, cancelRefetch },
)
```

ì´ë¥¼ ì‹¤ì‚¬ìš©ì—ì„œëŠ” mutatedì—ì„œ ì„±ê³µí–ˆì„ ë•Œ ì‹¤í–‰í•  í•¨ìˆ˜ë¥¼ ë„£ëŠ” í•„ë“œì¸ onSuccessì— ë„£ì–´ì¤Œìœ¼ë¡œì¨ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

ì‹¤ì œë¡œë„ ì´ëŸ°ì‹ìœ¼ë¡œ ë§ì´ ì§¤ ìˆ˜ ìˆëŠ”ë°ìš”. ì œê°€ 24ë…„ë„ 1í•™ê¸°ì— ì°¸ì—¬í•œ eeosì—ë„ ì´ëŸ¬í•œ ë¡œì§ì´ ë“¤ì–´ìˆìŠµë‹ˆë‹¤. 

```tsx
export const useCreateTeam = () => {
  const queryClient = useQueryClient();
  const queryKey = ["teams", "all"] as const;
  
  return useMutation({
    mutationKey: queryKey,
    mutationFn: (teamName: string) => createTeam(teamName),
    onMutate: () => {
      queryClient.invalidateQueries(["teams", "all"]); // mutate ìƒíƒœì¼ ë•Œ ìºì‹œë¥¼ ì‚­ì œí•´ë²„ë¦°ë‹¤. 
    }
  });
};
```

![Jul-30-2024_00-52-52](https://github.com/user-attachments/assets/c9f9ba27-7009-4846-8c3f-6a4940f0aeca)

ìŒ ì¢‹ë„¤ìš”! ì˜ ë™ì‘í•©ë‹ˆë‹¤. ê°’ì„ ë³€ê²½í•  ë•Œë§ˆë‹¤ ì„œë²„ì™€ ë™ê¸°í™”ë˜ì–´ì„œ í•´ë‹¹ ê°’ì„ ë‹¤ì‹œ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ë¯€ë¡œ ì‹ ë¢°ë„ê°€ ìˆëŠ” ì½”ë“œì…ë‹ˆë‹¤. ë§ˆì¹˜ ìºì‹œì˜ write-throughì™€ ìœ ì‚¬í•©ë‹ˆë‹¤. 

> EEOS ì— ëŒ€í•´ì„œ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?
>- EEOS ë§í¬ : [https://econo.eeos.store/](https://econo.eeos.store/)
>- EEOS dev ë°œí‘œ : https://www.youtube.com/live/L0XSyKOznSY?si=rw1PpwGlCCXOdNPO&t=5626
> 

í•˜ì§€ë§Œ, í•´ë‹¹ ì½”ë“œê°€ ë§ŒëŠ¥ì€ ì•„ë‹ˆì—ˆëŠ”ë°ìš”.. ì¬ ìš”ì²­ì„ í•´ì•¼ í•œë‹¤ëŠ” ì ì—ì„œ, ë§Œì•½ ë°ì´í„°ê°€ ìì£¼ ë³€ê²½ë˜ì–´ì•¼ í•œë‹¤ë©´ ì–´ëŠ ì •ë„ ì„±ëŠ¥ì ìœ¼ë¡œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ì˜ ì˜ìƒì—ì„œë„ ê·¸ë¦¬ ë¹ ë¥¸ ëŠë‚Œì´ ë“¤ì§€ ì•ŠìŠµë‹ˆë‹¤. ìœ ì €ì˜ ì…ì¥ì—ì„œëŠ” ë‹¹ì—°íˆ ì¢‹ì€ ê²½í—˜ì„ í•  ìˆ˜ëŠ” ì—†ê² ë„¤ìš”..

ì¡°ê¸ˆ ë” ë¹ ë¥´ê²Œ ê²°ê³¼ë¬¼ì„ ë°›ì•„ë³¼ ìˆ˜ëŠ” ì—†ì„ê¹Œìš”..? 

### ë‚™ê´€ì  ì—…ë°ì´íŠ¸

react-queryê°€ ì €ì¥í•˜ê³  ìˆëŠ” ë°ì´í„°ê°€ ìƒíƒœê°’ ì´ë¼ëŠ” ì ì— ì£¼ëª©ì„ í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ì¦‰ ì´ëŠ” ê°œë°œìê°€ ì–´ëŠì •ë„ ì¡°ì‘ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ë§ê³¼ë„ ë™ì¼í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. 

ì‹¤ì œë¡œ react-queryì—ì„œëŠ” ìƒíƒœ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒ ë¿ë§Œ ì•„ë‹ˆë¼ ìƒíƒœ ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ì†”ë£¨ì…˜ì´ ìˆìŠµë‹ˆë‹¤. ë§Œì•½ ì„œë²„ì˜ ë°ì´í„°ê°€ ì–´ë–¤ ê°’ìœ¼ë¡œ ë³€ê²½ë ì§€ ì˜ˆìƒì´ ê°€ëŠ¥í•˜ë‹¤ë©´, ì‹¤ì œ ì„œë²„ì˜ ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ë°”ë¡œ ìƒíƒœ ê°’ì„ ì—…ë°ì´íŠ¸í•´ì„œ uië¡œ ë³´ì—¬ì¤„ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œìš”? 

ì‹¤ì œë¡œ ì´ì™€ ê´€ë ¨í•œ ë‚´ìš©ì´ [ê³µì‹ë¬¸ì„œ](https://tanstack.com/query/latest/docs/framework/react/guides/mutations#persisting-offline-mutations)ì— ìˆëŠ”ë°ìš”..! 

```tsx
const queryClient = new QueryClient()

// Define the "addTodo" mutation
queryClient.setMutationDefaults(['addTodo'], {
  mutationFn: addTodo,
  onMutate: async (variables) => {
    // Cancel current queries for the todos list
    await queryClient.cancelQueries({ queryKey: ['todos'] })

    // Create optimistic todo
    const optimisticTodo = { id: uuid(), title: variables.title }

    // Add optimistic todo to todos list
    queryClient.setQueryData(['todos'], (old) => [...old, optimisticTodo])

    // Return context with the optimistic todo
    return { optimisticTodo }
  },
  onSuccess: (result, variables, context) => {
    // Replace optimistic todo in the todos list with the result
    queryClient.setQueryData(['todos'], (old) =>
      old.map((todo) =>
        todo.id === context.optimisticTodo.id ? result : todo,
      ),
    )
  },
  onError: (error, variables, context) => {
    // Remove optimistic todo from the todos list
    queryClient.setQueryData(['todos'], (old) =>
      old.filter((todo) => todo.id !== context.optimisticTodo.id),
    )
  },
  retry: 3,
})

// Start mutation in some component:
const mutation = useMutation({ mutationKey: ['addTodo'] })
mutation.mutate({ title: 'title' })

// If the mutation has been paused because the device is for example offline,
// Then the paused mutation can be dehydrated when the application quits:
const state = dehydrate(queryClient)

// The mutation can then be hydrated again when the application is started:
hydrate(queryClient, state)

// Resume the paused mutations:
queryClient.resumePausedMutations()
```

ì£¼ìš” ë¶€ë¶„ì„ í•˜ë‚˜ì”© í’€ì–´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. 

- `await queryClient.cancelQueries({ queryKey: ['todos'] })` : í•´ë‹¹ ì¿¼ë¦¬ í‚¤ì— ëŒ€í•œ ì§„í–‰ ì¤‘ì¸ ì¿¼ë¦¬ë¥¼ ì·¨ì†Œí•œë‹¤. ì´ëŠ” ë°ì´í„°ë¥¼ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•¨ì´ë‹¤.
    - ìœ„ì˜ ë¡œì§ì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì •í•¨ê³¼ ë™ì‹œì— ë‹¤ë¥¸ ê³³ì—ì„œ fetchë¥¼ í•˜ê±°ë‚˜ ë³€ê²½í•˜ëŠ” ë“±ì˜ ì‘ì—…ì´ ê²¹ì³ ë°ì´í„°ì˜ ì¼ê´€ì„±ì´ í›¼ì†ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.
    - í•œë§ˆë””ë¡œ ê²½ìŸ ìƒíƒœë¥¼ ë§‰ê¸° ìœ„í•œ ë°©ë²•ì´ë‹¤.
- `queryClient.setQueryData()` : í•´ë‹¹ ì¿¼ë¦¬ í‚¤ì˜ ìƒíƒœê°’ì„ ì…ë ¥í•œ ê°’ìœ¼ë¡œ ë³€ê²½í•œë‹¤.
- `onMutate : () => {return { optimisticTodo }}` : onMutateì—ì„œ ë¦¬í„´í•œ ê°’ì€ ë‹¤ë¥¸ ìƒíƒœê°’ì—ì„œ ì‚¬ìš©ì´ ê°€ëŠ¥í•œ contextê°’ì´ ëœë‹¤.
    - ì´ëŠ” ì‹¤íŒ¨ì‹œì— ì •í™•íˆ í•´ë‹¹ ë³€ê²½ëœ ê°’ë§Œ ê°€ì ¸ì™€ ë¹¼ê¸° ìœ„í•¨ìœ¼ë¡œ ë³´ì¸ë‹¤.

ì§ì ‘ ìƒíƒœê°’ì— ì ‘ê·¼í•´ì„œ í•´ë‹¹ ê°’ì„ ë³€ê²½í•´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ë³€ê²½ëœ eeos ì½”ë“œë¥¼ ë´ë´…ì‹œë‹¤.

```tsx
export const useCreateTeam = () => {
  const queryClient = useQueryClient();
  const queryKey = ["teams", "all"] as const;

  return useMutation({
    mutationKey: queryKey,
    mutationFn: createTeam,
    onMutate: async (teamName: string) => {
      await queryClient.cancelQueries(queryKey); // ì§„í–‰ì¤‘ì¸ ì¿¼ë¦¬ ì‘ì—… ì¤‘ì§€

			// ì´ì „ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const previousTeams = queryClient.getQueryData<{ teams: TeamInfo[] }>(
        queryKey,
      );

			// ë§Œì•½ ìºì‹±ì´ ë˜ì–´ìˆë‹¤ë©´ ìƒˆë¡­ê²Œ ë³€ê²½ë  ë°ì´í„°ë¡œ ìƒíƒœê°’ ì—…ë°ì´íŠ¸ 
      if (previousTeams) {
        const newTeam: TeamInfo = { teamId: Date.now(), teamName };
        queryClient.setQueryData(queryKey, {
          teams: [...previousTeams.teams, newTeam],
        });
      }

			// ì´ì „ ë°ì´í„° ì»¨í…ìŠ¤íŠ¸ì— ë‹´ê¸°
      return { previousTeams };
    },
    onError: (err, newTeam, context) => {
    // ì—ëŸ¬ê°€ ë°œìƒí–ˆê³ , ì´ì „ ë°ì´í„°ê°€ ìˆì—ˆë‹¤ë©´ ì´ì „ ë°ì´í„°ë¡œ ëŒë¦¬ê¸°
      if (context?.previousTeams) {
        queryClient.setQueryData(queryKey, context.previousTeams);
      }
    },
    onSettled: () => {
    
    // ë®¤í…Œì´ì…˜ì´ ì„±ê³µí•˜ë“  ì‹¤íŒ¨í•˜ë“  ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡
      queryClient.invalidateQueries(queryKey);
    },
  });
};

```

![Jul-30-2024_01-13-36](https://github.com/user-attachments/assets/37d574c1-c394-46d4-b4c4-e952fceeea37)

ì™€ìš°.. í™•ì‹¤íˆ ë¹¨ë¼ì§„ ê²ƒì„ ë³¼ ìˆ˜ ìˆë„¤ìš”..! 

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ ë°©ì‹ì€ Write-Throughì˜ ëŠë¦° ì„±ëŠ¥ì„ ê°œì„ í•œ Write-Backê³¼ ìœ ì‚¬í•œ ëŠë‚Œì´ ë“œë„¤ìš”!

## ê²°ë¡ 

ì§€ê¸ˆê¹Œì§€ ì»´í“¨í„° êµ¬ì¡°ì—ì„œì˜ ìºì‹œ ê°œë…ì„ ì›¹ ê°œë°œë¡œ í™•ì¥í•´ ë³´ë©° ì´ ì—­í• ì„ í•´ì£¼ëŠ” react-queryì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤. 

react-queryëŠ” ì„œë²„ ìƒíƒœê´€ë¦¬ì˜ í•µì‹¬ ë„êµ¬ë¡œ, í˜„ì¬ë¡œì„œëŠ” ë¦¬ì•¡íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ê±°í¬ í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. 

ë‹¤ë§Œ ì´ë¥¼ ì–´ëŠì •ë„ ì˜ ì‚¬ìš©í•´ì•„ë§Œ í•©ë‹ˆë‹¤. ìœ ì €ì˜ ê´€ì ì—ì„œ ì–´ë–»ê²Œ ì„±ëŠ¥ì„ ìµœì í™” í•  ìˆ˜ ìˆì„ì§€ì— ëŒ€í•´ì„œ ê³ ë¯¼í•´ë³¼ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.

 ì•„ë˜ëŠ” ì¡°ê¸ˆ ë” ê°œë…ì ìœ¼ë¡œ ê³µë¶€í•  ë§Œí•œ í˜ì´ì§€ë“¤ ì…ë‹ˆë‹¤. 

- react-query ê¸°ìˆ  ë¸”ë¡œê·¸ : https://tanstack.com/query/latest/docs/framework/react/community/tkdodos-blog#5-testing-react-query
- tanstack-query : [https://tanstack.com/](https://tanstack.com/)
